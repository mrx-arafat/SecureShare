<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Share Template - SecureShare</title>
    <link rel="stylesheet" href="../popup/css/vendor/balloon.min.css">
    <link rel="stylesheet" href="../popup/css/styles.css">
    <style>
        body {
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .demo-container {
            width: 32rem;
            max-width: 32rem;
            max-height: 48rem;
            min-height: 32rem;
            min-width: 32rem;
        }
        
        .demo-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--glass-bg);
            border: var(--glass-border);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            backdrop-filter: var(--glass-backdrop);
            -webkit-backdrop-filter: var(--glass-backdrop);
            box-shadow: var(--shadow-md);
            z-index: 1000;
        }
        
        .demo-controls button {
            display: block;
            width: 100%;
            margin-bottom: var(--space-sm);
        }
        
        .demo-controls button:last-child {
            margin-bottom: 0;
        }
    </style>
</head>
<body class="body">
    <div class="demo-controls">
        <button class="btn btn-secondary" onclick="showShareForm()">Show Share Form</button>
        <button class="btn btn-secondary" onclick="showShareResult()">Show Share Result</button>
        <button class="btn btn-secondary" onclick="toggleExpiresOn()">Toggle Expires</button>
        <button class="btn btn-secondary" onclick="resetForm()">Reset Form</button>
    </div>

    <div class="app demo-container">
        <!-- Complete Share Template -->
        <section class="share">
            <div class="back-button-top">
                <div class="js-go-back-top go-back-top link">&lsaquo;</div>
            </div>
            <div class="title">Current Account</div>
            <div class="explanation">You're about to share your <i>"AI Augmentation Development Guidelines - Claude"</i> session.</div>
            
            <form action="/" id="js-share-session">
                <div class="small">Recipient code <span class="link" data-balloon="Paste the code of the person you want to share your extension with. It can be found on the 'Receive account' section." data-balloon-length="large" data-balloon-pos="right">?</span></div>
                
                <div class="input-container">
                    <input type="text" name="pubkey" value="" placeholder="Code of the computer you're sharing with" autocomplete="off" required />
                </div>
                
                <div class="small">Timeout in hours <span class="link" data-balloon="How long the shared session will remain valid. Default is 168 hours (1 week)." data-balloon-length="large" data-balloon-pos="right">?</span></div>
                
                <div class="input-container timeout-container">
                    <input type="number" name="timeout" value="" min="1" placeholder="It'll last a week by default." autocomplete="off" />
                    <div id="js-expires-on" class="expires-on"></div>
                </div>
                
                <div class="flex-container">
                    <div class="js-go-back go-back link">‹ back</div>
                    <input type="submit" name="submit" class="btn" value="Share" disabled />
                </div>
            </form>
            
            <!-- Share Result Section -->
            <div id="js-shared-session" class="shared-session hidden">
                <div class="small">Share result <span class="link" data-balloon="Share this encrypted text with the owner of the recipient code. They can use it to access your session." data-balloon-length="large" data-balloon-pos="right">?</span> <span id="js-session-hide" class="link delete">×</span></div>
                
                <pre id="js-shared-session-text" class="encrypted-data share-result">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.EkN-DOsnsuRjRO6BxXemmJDm3HbxrbRzXglbN2S4sOkopdU4IsDxTI8jO19W_A4K8ZPJijNLis4EZsHeY559a4DFOd50_OqgHs3UjlKOCuOuFiF6_CnImOlK4g6k2-WgjMGlzYNnaAjNu2U9aSEiMYBqGRTLPbYLdaHHVfgUDjI.additional_encrypted_session_data_here_that_would_be_much_longer_in_real_usage_scenario</pre>
                
                <div class="action-icon" data-clipboard data-clipboard-target="#js-shared-session-text" data-balloon="Copy encrypted session data" data-balloon-pos="right">
                    <img src="../popup/images/copy.svg" alt="Copy encryption" width="12" />
                </div>
                
                <div class="share-text-link">
                    <strong>Share Link:</strong> https://secureshare.app/receive?data=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9
                </div>
            </div>
        </section>
    </div>
    
    <script>
        // Demo functionality
        let formState = 'form'; // 'form' or 'result'
        
        function showShareForm() {
            document.getElementById('js-shared-session').classList.add('hidden');
            document.querySelector('form').style.display = 'flex';
            formState = 'form';
        }
        
        function showShareResult() {
            document.getElementById('js-shared-session').classList.remove('hidden');
            document.querySelector('form').style.display = 'none';
            formState = 'result';
        }
        
        function toggleExpiresOn() {
            const expiresEl = document.getElementById('js-expires-on');
            expiresEl.classList.toggle('visible');
        }
        
        function resetForm() {
            document.querySelector('input[name="pubkey"]').value = '';
            document.querySelector('input[name="timeout"]').value = '';
            document.getElementById('js-expires-on').classList.remove('visible');
            document.querySelector('input[type="submit"]').disabled = true;
            showShareForm();
        }
        
        // Enhanced functionality
        document.addEventListener('DOMContentLoaded', () => {
            const recipientInput = document.querySelector('input[name="pubkey"]');
            const timeoutInput = document.querySelector('input[name="timeout"]');
            const expiresOn = document.getElementById('js-expires-on');
            const submitBtn = document.querySelector('input[type="submit"]');
            const sharedSession = document.getElementById('js-shared-session');
            const sessionHide = document.getElementById('js-session-hide');
            
            // Function to update expires date
            function updateExpiresDate() {
                const hours = parseInt(timeoutInput.value) || 168; // Default 1 week
                const expiryDate = new Date();
                expiryDate.setHours(expiryDate.getHours() + hours);
                
                const options = { 
                    weekday: 'short', 
                    month: 'short', 
                    day: 'numeric', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                };
                
                expiresOn.textContent = `Expires: ${expiryDate.toLocaleDateString('en-US', options)}`;
                expiresOn.classList.add('visible');
            }
            
            // Function to check form validity
            function checkFormValidity() {
                const isValid = recipientInput.value.trim().length > 0;
                submitBtn.disabled = !isValid;
            }
            
            // Event listeners
            timeoutInput.addEventListener('input', () => {
                if (timeoutInput.value) {
                    updateExpiresDate();
                } else {
                    expiresOn.classList.remove('visible');
                }
            });
            
            recipientInput.addEventListener('input', checkFormValidity);
            
            // Form submission
            document.getElementById('js-share-session').addEventListener('submit', (e) => {
                e.preventDefault();
                showShareResult();
            });
            
            // Hide result
            sessionHide.addEventListener('click', () => {
                sharedSession.classList.add('hidden');
            });
            
            // Go back functionality
            document.querySelector('.js-go-back').addEventListener('click', () => {
                // In real app, this would navigate back to menu
                alert('Go back to main menu (demo)');
            });

            // Top back button functionality
            document.querySelector('.js-go-back-top').addEventListener('click', () => {
                // In real app, this would navigate back to menu
                alert('Go back to main menu (demo - top button)');
            });
            
            // Copy functionality simulation
            document.querySelector('.action-icon').addEventListener('click', () => {
                alert('Encrypted data copied to clipboard! (demo)');
            });
            
            // Demo: Add sample data after delay to test expires functionality
            setTimeout(() => {
                recipientInput.value = 'DEF456GHI789';
                timeoutInput.value = '48';
                checkFormValidity();
                updateExpiresDate();

                // Test that expires element is visible
                console.log('Expires element content:', expiresOn.textContent);
                console.log('Expires element visible:', !expiresOn.classList.contains('hidden'));
            }, 2000);
        });
    </script>
</body>
</html>
