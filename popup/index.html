<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureShare - Share Accounts Securely</title>

    <!-- Styles -->
    <link rel="stylesheet" href="css/vendor/balloon.min.css">
    <link rel="stylesheet" href="css/styles.css">
  </head>
  <body class="body">

    <div id="app" class="app"></div>


    <template id="js-template-menu">
      <div class="menu">
        <div class="menu-app-logo">
          <a href="https://profile.arafatops.com" target="_blank">
            <img src="./images/header-logo.png" alt="Secure Share logo" width="120">
          </a>
          <div class="app-tagline">Share accounts securely without passwords</div>
        </div>

        <div class="menu-actions">
          <button class="btn btn-primary" data-menu="share">
            <span class="btn-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0110 0v4"/>
              </svg>
            </span>
            <span class="btn-text">Share Session</span>
          </button>
          <button class="btn btn-secondary" data-menu="restore">
            <span class="btn-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 019.9-1"/>
              </svg>
            </span>
            <span class="btn-text">Restore Session</span>
          </button>
          <button class="btn btn-secondary" data-menu="qr-share">
            <span class="btn-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
                <line x1="12" y1="18" x2="12.01" y2="18"/>
              </svg>
            </span>
            <span class="btn-text">Share Current Session</span>
          </button>
          <button class="btn btn-secondary" data-menu="history">
            <span class="btn-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 11 12 14 22 4"/>
                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
              </svg>
            </span>
            <span class="btn-text">Session History</span>
          </button>
          <button class="btn btn-secondary" data-menu="settings">
            <span class="btn-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6m8.66-15l-5.2 3m-5.92 3l-5.2 3m0-12l5.2 3m5.92 3l5.2 3"/>
              </svg>
            </span>
            <span class="btn-text">Settings</span>
          </button>
        </div>

        <div class="menu-footer">
          <div class="version-info">v1.3.0</div>
          <div class="privacy-note">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0110 0v4"/>
            </svg>
            All data encrypted locally
          </div>
        </div>
      </div>
    </template>


    <template id="js-template-share">
      <section class="share">
        <div class="share-header">
          <div class="js-go-back-top share-back-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <h2 class="share-title">
            <span class="share-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0110 0v4"/>
              </svg>
            </span>
            Share Session
          </h2>
        </div>

        <div class="share-container">
          <!-- Current Session Info -->
          <div class="session-info-card">
            <div class="session-info-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2"/>
              </svg>
            </div>
            <div class="session-info-content">
              <div class="session-info-label">Currently sharing from</div>
              <div class="session-info-title">{{=tab.title}}</div>
              <div class="session-info-url">{{=tab.url}}</div>
            </div>
          </div>

          <!-- Share Form -->
          <form action="/" id="js-share-session" class="share-form">
            <!-- Step 1: Recipient Code -->
            <div class="share-card">
              <div class="share-card-header">
                <div class="step-number">1</div>
                <div>
                  <h3 class="share-card-title">Enter Recipient Code</h3>
                  <p class="share-card-description">Get this from the person receiving the session</p>
                </div>
              </div>

              <div class="recipient-input-group">
                <div class="input-header">
                  <label for="recipient-code" class="input-label">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
                      <circle cx="12" cy="7" r="4"/>
                    </svg>
                    Recipient's Device Code
                  </label>
                  <span class="help-tooltip" data-tooltip="The recipient can find this code in their 'Restore Session' section">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                      <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                  </span>
                </div>
                <input
                  type="text"
                  id="recipient-code"
                  name="pubkey"
                  class="share-input"
                  placeholder='{"x":"7b5e2c8a9f3d1e4b6a8c2d5f7e9b3c6d8f1a4e7b9c2d5f8a1b3e6c9d2f5a8b","y":"4c7d9e2f5a8b1c3e6d9f2a5b8c1d4e7f9a2c5d8e1b4f7a9d2e5b8c1f4a7d9e"}'
                  autocomplete="off"
                  required
                />
              </div>
            </div>

            <!-- Step 2: Expiration Time -->
            <div class="share-card">
              <div class="share-card-header">
                <div class="step-number">2</div>
                <div>
                  <h3 class="share-card-title">Set Expiration Time</h3>
                  <p class="share-card-description">How long should the session remain active?</p>
                </div>
              </div>

              <div class="timeout-input-group">
                <div class="input-header">
                  <label for="timeout-hours" class="input-label">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    Hours Until Expiration
                  </label>
                  <span class="help-tooltip" data-tooltip="Default is 168 hours (1 week). Maximum is 720 hours (30 days)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                      <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                  </span>
                </div>
                <input
                  type="number"
                  id="timeout-hours"
                  name="timeout"
                  class="share-input"
                  min="1"
                  max="720"
                  placeholder="168"
                  value="168"
                  autocomplete="off"
                />
                <div id="js-expires-on" class="expiration-preview"></div>
              </div>
            </div>

            <!-- Actions -->
            <div class="share-actions">
              <button type="button" class="js-go-back share-btn share-btn-secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="15 18 9 12 15 6"/>
                </svg>
                Back
              </button>
              <button type="submit" name="submit" class="share-btn share-btn-primary" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                  <path d="M2 17l10 5 10-5"/>
                  <path d="M2 12l10 5 10-5"/>
                </svg>
                Generate Encrypted Session
              </button>
            </div>
          </form>

          <!-- Share Result -->
          <div id="js-shared-session" class="share-result-card hidden">
            <div class="result-header">
              <h3 class="result-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                Session Encrypted Successfully
              </h3>
              <button type="button" id="js-session-hide" class="result-close">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"/>
                  <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
              </button>
            </div>

            <div class="result-content">
              <div class="result-label">Encrypted Session Data</div>
              <div class="result-data-wrapper">
                <pre id="js-shared-session-text" class="result-data"></pre>
                <button type="button" class="copy-btn" data-clipboard data-clipboard-target="#js-shared-session-text">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                    <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                  </svg>
                  Copy
                </button>
              </div>
              <div class="result-help">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="16" x2="12" y2="12"/>
                  <line x1="12" y1="8" x2="12.01" y2="8"/>
                </svg>
                <span>Send this encrypted data to the recipient. Only they can decrypt it with their private key.</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div id="js-error" class="error hidden"></div>
    </template>

  <!-- qr-share  for sharing accounts to mobile devices -->

    <template id="js-template-restore">
      <section class="restore">
        <div class="restore-header">
          <div class="js-go-back-top restore-back-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <h2 class="restore-title">
            <span class="restore-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 019.9-1"/>
              </svg>
            </span>
            Restore Session
          </h2>
        </div>

        <div class="restore-container">
          <!-- Step 1: Your Device Code -->
          <div class="restore-card">
            <div class="restore-card-header">
              <div class="step-number">1</div>
              <div>
                <h3 class="restore-card-title">Your Device Code</h3>
                <p class="restore-card-description">Share this code with the sender</p>
              </div>
            </div>

            <div class="device-code-section">
              <div class="code-input-wrapper">
                <input
                  id="js-user-pubkey"
                  name="pubkey"
                  type="text"
                  value="{{=publicKey}}"
                  readonly
                  class="device-code-input"
                />
                <div class="code-actions">
                  <button type="button" class="code-action-btn" data-clipboard data-clipboard-target="#js-user-pubkey" title="Copy code">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                      <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                    </svg>
                  </button>
                  <button type="button" id="js-regenerate-keys" class="code-action-btn" title="Generate new code">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="23 4 23 10 17 10"/>
                      <polyline points="1 20 1 14 7 14"/>
                      <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="code-help">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="16" x2="12" y2="12"/>
                  <line x1="12" y1="8" x2="12.01" y2="8"/>
                </svg>
                <span>This code allows others to encrypt sessions specifically for you</span>
              </div>
            </div>
          </div>

          <!-- Step 2: Paste Encrypted Session -->
          <div class="restore-card">
            <div class="restore-card-header">
              <div class="step-number">2</div>
              <div>
                <h3 class="restore-card-title">Paste Encrypted Session</h3>
                <p class="restore-card-description">Enter the encrypted data from the sender</p>
              </div>
            </div>

            <form action="/" id="js-restore-session" class="restore-form">
              <div class="session-input-group">
                <div class="session-input-header">
                  <label for="encrypted-data" class="session-label">
                    Encrypted Session Data
                  </label>
                  <span class="session-help-icon" data-balloon="Only you can decrypt this data with your device code" data-balloon-pos="left">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                      <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                  </span>
                </div>

                <textarea
                  name="encrypted-data"
                  id="encrypted-data"
                  class="session-textarea"
                  placeholder='Paste the encrypted session data here...

Example format:
{"iv":"C+Qfxtx6UM6YkQ7glsVsLg==", "v":1, "iter":10000, ...}'
                  rows="8"
                ></textarea>

                <div id="js-restore-notice" class="restore-notice"></div>
              </div>

              <div class="restore-actions">
                <button type="button" class="js-go-back restore-btn restore-btn-secondary">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"/>
                  </svg>
                  Back
                </button>
                <button type="submit" name="submit" class="restore-btn restore-btn-primary" disabled>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                  </svg>
                  Restore Session
                </button>
              </div>
            </form>
          </div>

          <!-- Info Card -->
          <div class="restore-info-card">
            <div class="info-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
              </svg>
            </div>
            <div class="info-content">
              <h4>End-to-End Encrypted</h4>
              <p>Sessions are encrypted with your device code. Only you can decrypt them.</p>
            </div>
          </div>
        </div>
      </section>

      <div id="js-error" class="error hidden"></div>
    </template>

    <template id="js-template-qr-share">
      <section class="qr-share">
        <div class="back-button-top">
          <div class="js-go-back-top go-back-top link">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>

        <div class="title">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
            <rect x="3" y="3" width="7" height="7"/>
            <rect x="14" y="3" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/>
          </svg>
          Share Current Session
        </div>
        <div class="explanation">Generate a secure QR code to share your login session with mobile devices</div>

        <div class="qr-generation">
          <div class="current-session-info">
            <div class="small">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                <circle cx="12" cy="12" r="10"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/>
              </svg>
              Current Website
            </div>
            <div class="session-details">
              <div class="session-title">{{=tab.title}}</div>
              <div class="session-url">{{=tab.url}}</div>
            </div>
            <div class="session-status" id="js-session-status">
              <div class="status-item">
                <span class="status-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                  </svg>
                </span>
                <span class="status-text">Checking login status...</span>
              </div>
            </div>

            <div class="login-status" id="js-login-status" style="display: none;">
              <div class="small">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                  <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                Login Status
              </div>
              <div class="login-info">
                <div class="login-indicator">
                  <span class="login-icon" id="js-login-icon">‚ùì</span>
                  <span class="login-text" id="js-login-text">Unknown</span>
                  <span class="login-confidence" id="js-login-confidence">0%</span>
                </div>
                <div class="user-info" id="js-user-info" style="display: none;">
                  <div class="user-display">
                    <span class="user-label">Logged in as:</span>
                    <span class="user-value" id="js-user-display">Not detected</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="session-preview" id="js-session-preview" style="display: none;">
              <div class="small">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                  <path d="M21.21 15.89A10 10 0 118 2.83"/>
                  <path d="M22 12A10 10 0 0012 2v10z"/>
                </svg>
                Session Information
              </div>
              <div class="preview-items">
                <div class="preview-item">
                  <span class="preview-label">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 2px;">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="2" y1="12" x2="22" y2="12"/>
                      <path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/>
                    </svg>
                    Website:
                  </span>
                  <span class="preview-value" id="js-preview-website">-</span>
                </div>
                <div class="preview-item">
                  <span class="preview-label">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 2px;">
                      <circle cx="12" cy="12" r="10"/>
                      <circle cx="12" cy="12" r="6"/>
                      <circle cx="12" cy="12" r="2"/>
                    </svg>
                    Session Cookies:
                  </span>
                  <span class="preview-value" id="js-preview-cookies">-</span>
                </div>
                <div class="preview-item">
                  <span class="preview-label">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 2px;">
                      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                      <path d="M7 11V7a5 5 0 0110 0v4"/>
                    </svg>
                    Security Level:
                  </span>
                  <span class="preview-value" id="js-preview-security">-</span>
                </div>
                <div class="preview-item">
                  <span class="preview-label">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 2px;">
                      <circle cx="12" cy="12" r="10"/>
                      <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    Estimated Duration:
                  </span>
                  <span class="preview-value" id="js-preview-duration">30 minutes</span>
                </div>
              </div>
            </div>
          </div>

          <div class="session-actions">
            <button id="js-refresh-session" class="btn btn-secondary">
              <span class="btn-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="23 4 23 10 17 10"/>
                  <polyline points="1 20 1 14 7 14"/>
                  <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                </svg>
              </span>
              <span class="btn-text">Refresh Session</span>
            </button>
            <button id="js-generate-qr-share" class="btn btn-primary">
              <span class="btn-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="7" height="7"/>
                  <rect x="14" y="3" width="7" height="7"/>
                  <rect x="14" y="14" width="7" height="7"/>
                  <rect x="3" y="14" width="7" height="7"/>
                </svg>
              </span>
              <span class="btn-text">Generate QR Code</span>
            </button>
          </div>

          <div id="js-qr-loading" class="qr-loading hidden">
            <div class="loading-spinner"></div>
            <div class="loading-text">Generating QR code...</div>
          </div>

          <div id="js-qr-result" class="qr-result hidden">
            <div class="qr-header">
              <div class="small">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                  <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
                  <line x1="12" y1="18" x2="12.01" y2="18"/>
                </svg>
                Scan with your mobile device
              </div>
              <div class="qr-status" id="js-qr-status">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                  <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                QR Code ready!
              </div>
            </div>

            <div class="qr-container">
              <canvas id="js-qr-canvas-share" width="200" height="200"></canvas>
              <div class="qr-overlay" id="js-qr-overlay">
                <div class="qr-overlay-content">
                  <div class="qr-overlay-icon">üì±</div>
                  <div class="qr-overlay-text">QR Code will appear here</div>
                </div>
              </div>
            </div>

            <div class="qr-info">
              <div class="small">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                  <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/>
                  <rect x="9" y="3" width="6" height="4" rx="2"/>
                </svg>
                How to use:
              </div>
              <div class="qr-steps">
                <div class="qr-step">
                  <span class="step-number">1</span>
                  <span class="step-text">Scan QR code with your mobile device</span>
                </div>
                <div class="qr-step">
                  <span class="step-number">2</span>
                  <span class="step-text">Tap the secure link notification</span>
                </div>
                <div class="qr-step">
                  <span class="step-number">3</span>
                  <span class="step-text">Session applies automatically</span>
                </div>
                <div class="qr-step">
                  <span class="step-number">4</span>
                  <span class="step-text">You're logged in - no password needed!</span>
                </div>
              </div>
              <div class="qr-examples">
                <div class="small">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                  </svg>
                  Perfect for:
                </div>
                <div class="example-text">‚Ä¢ Share Netflix with friends</div>
                <div class="example-text">‚Ä¢ Access work accounts on mobile</div>
                <div class="example-text">‚Ä¢ Quick login without typing passwords</div>
              </div>
            </div>

            <div class="qr-actions">
              <button id="js-copy-qr-link" class="btn btn-secondary">
                <span class="btn-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                    <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                  </svg>
                </span>
                <span class="btn-text">Copy Link</span>
              </button>
              <button id="js-regenerate-qr" class="btn">
                <span class="btn-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"/>
                    <polyline points="1 20 1 14 7 14"/>
                    <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                  </svg>
                </span>
                <span class="btn-text">Regenerate</span>
              </button>
              <button id="js-download-qr" class="btn">
                <span class="btn-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                  </svg>
                </span>
                <span class="btn-text">Download</span>
              </button>
            </div>

            <div class="qr-fallback" id="js-qr-fallback" style="display: none;">
              <div class="fallback-header">
                <div class="fallback-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                  </svg>
                </div>
                <div class="fallback-title">QR Code generation failed</div>
              </div>
              <div class="fallback-content">
                <div class="fallback-text">You can still share by copying the link below:</div>
                <div class="fallback-url" id="js-fallback-url"></div>
                <button id="js-copy-fallback-link" class="btn btn-primary">
                  <span class="btn-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                      <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                    </svg>
                  </span>
                  <span class="btn-text">Copy Link</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="js-go-back go-back link">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>back</span>
        </div>
      </section>

      <div id="js-error" class="error hidden"></div>
    </template>

    <template id="js-template-history">
      <section class="history">
        <div class="back-button-top">
          <div class="js-go-back-top go-back-top link">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>
        <div class="title">Shared accounts</div>
        <div class="explanation">We only keep track of URLs and titles and only for a month, nothing else is stored</div>

        <div class="sessions">
          {{hasSessions}}
            {{@sessions}}
              <h5>Shared on {{=_key}} <span class="link delete js-delete" data-key="{{=_key}}">x</span></h5>
              <ul>
                {{@_val}}
                  <li>
                    <a class="session-url" href="{{=_val.url}}" target="_blank">{{=_val.title}}</a>
                  </li>
                {{/@_val}}
              </ul>
            {{/@sessions}}
          {{:hasSessions}}
            <div class="small">No shared accounts yet</div>
          {{/hasSessions}}
        </div>

        <div class="js-go-back go-back link">&lsaquo; back</div>
      </section>

      <div id="js-error" class="error hidden"></div>
    </template>

    <template id="js-template-settings">
      <section class="settings">
        <div class="settings-header">
          <div class="js-go-back-top settings-back-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <h2 class="settings-title">
            <span class="settings-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6m8.66-15l-5.2 3m-5.92 3l-5.2 3m0-12l5.2 3m5.92 3l5.2 3"/>
              </svg>
            </span>
            Settings
          </h2>
        </div>

        <div class="settings-container">
          <!-- GitHub Integration Section -->
          <div class="settings-card">
            <div class="settings-card-header">
              <div class="settings-card-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
              </div>
              <div>
                <h3 class="settings-card-title">GitHub Integration</h3>
                <p class="settings-card-description">Save encrypted sessions as private Gists</p>
              </div>
            </div>

            <form id="js-github-settings" class="github-settings-form">
              <div class="token-input-group">
                <label for="github-token" class="token-label">
                  <span>Personal Access Token</span>
                  <span class="token-status" id="js-token-status"></span>
                </label>
                <div class="token-input-wrapper">
                  <input
                    type="password"
                    id="github-token"
                    name="githubToken"
                    placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
                    class="token-input"
                    autocomplete="off"
                  />
                  <button type="button" class="token-toggle" id="js-toggle-token">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                  </button>
                </div>
                <div class="token-help">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="16" x2="12" y2="12"/>
                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                  </svg>
                  <span>Need a token? <a href="https://github.com/settings/tokens/new?description=SecureShare&scopes=gist" target="_blank" rel="noopener">Generate one here</a> with 'gist' scope</span>
                </div>
              </div>

              <div class="settings-actions">
                <button type="submit" class="settings-btn settings-btn-primary">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                    <polyline points="17 21 17 13 7 13 7 21"/>
                    <polyline points="7 3 7 8 15 8"/>
                  </svg>
                  Save Token
                </button>
                <button type="button" id="js-test-token" class="settings-btn settings-btn-secondary">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                  </svg>
                  Test Connection
                </button>
                <button type="button" id="js-remove-token" class="settings-btn settings-btn-danger hidden">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                  </svg>
                  Remove Token
                </button>
              </div>

              <div id="js-github-status" class="settings-status hidden">
                <div class="status-message"></div>
              </div>
            </form>
          </div>

          <!-- Gist History Section -->
          <div class="settings-card">
            <div class="settings-card-header">
              <div class="settings-card-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12 6 12 12 16 14"/>
                </svg>
              </div>
              <div>
                <h3 class="settings-card-title">Recent Gists</h3>
                <p class="settings-card-description">Your saved session history</p>
              </div>
            </div>

            <div id="js-gist-history" class="gist-history">
              <div class="gist-empty-state">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3">
                  <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                  <line x1="16" y1="13" x2="8" y2="13"/>
                  <line x1="16" y1="17" x2="8" y2="17"/>
                  <polyline points="10 9 9 9 8 9"/>
                </svg>
                <p>No gists created yet</p>
                <span class="gist-empty-hint">Share a session and save it to GitHub to see it here</span>
              </div>
            </div>
          </div>

          <!-- About Section -->
          <div class="settings-card">
            <div class="settings-card-header">
              <div class="settings-card-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="16" x2="12" y2="12"/>
                  <line x1="12" y1="8" x2="12.01" y2="8"/>
                </svg>
              </div>
              <div>
                <h3 class="settings-card-title">About SecureShare</h3>
                <p class="settings-card-description">Version 1.3.0</p>
              </div>
            </div>

            <div class="settings-about">
              <div class="about-item">
                <span class="about-label">Developer</span>
                <span class="about-value">Easin Arafat</span>
              </div>
              <div class="about-item">
                <span class="about-label">License</span>
                <span class="about-value">MIT</span>
              </div>
              <div class="about-item">
                <span class="about-label">GitHub</span>
                <a href="https://github.com/mrx-arafat/SecureShare" target="_blank" class="about-link">View on GitHub</a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div id="js-error" class="error hidden"></div>
    </template>


    <!-- Chrome API Mocks for Browser Testing -->
    <script>
        // Mock Chrome APIs when running in browser (not extension context)
        if (!window.chrome || !window.chrome.tabs) {
            console.log('üîß Initializing Chrome API mocks for browser testing...');

            window.chrome = window.chrome || {};

            // Mock tabs API
            window.chrome.tabs = {
                query: function(queryInfo, callback) {
                    const mockTab = {
                        id: 1,
                        url: window.location.href.includes('github.com') ? 'https://github.com' : 'https://example.com',
                        title: 'Test Page',
                        active: true,
                        windowId: 1
                    };
                    setTimeout(() => callback([mockTab]), 10);
                },
                create: function(createProperties) {
                    console.log('Mock: Would create tab with URL:', createProperties.url);
                    window.open(createProperties.url, '_blank');
                }
            };

            // Mock cookies API
            window.chrome.cookies = {
                getAll: function(details, callback) {
                    const mockCookies = [
                        { name: 'session_id', value: 'mock_session_123', domain: '.example.com', secure: true, httpOnly: true, path: '/', expirationDate: Math.floor(Date.now() / 1000) + 3600 },
                        { name: 'user_pref', value: 'mock_pref_456', domain: '.example.com', secure: true, httpOnly: false, path: '/', expirationDate: Math.floor(Date.now() / 1000) + 3600 },
                        { name: 'csrf_token', value: 'mock_csrf_789', domain: '.example.com', secure: true, httpOnly: false, path: '/', expirationDate: Math.floor(Date.now() / 1000) + 3600 }
                    ];
                    console.log('Mock: Returning cookies for', details.url, mockCookies);
                    setTimeout(() => callback(mockCookies), 10);
                },
                set: function(details, callback) {
                    console.log('Mock: Would set cookie:', details);
                    if (callback) setTimeout(() => callback(details), 10);
                }
            };

            // Mock runtime API
            window.chrome.runtime = {
                lastError: null,
                getManifest: function() {
                    return { version: '1.3.0' };
                }
            };

            // Mock storage API
            window.chrome.storage = {
                local: {
                    get: function(keys, callback) {
                        const mockData = {};
                        if (typeof keys === 'string') {
                            mockData[keys] = null;
                        } else if (Array.isArray(keys)) {
                            keys.forEach(key => mockData[key] = null);
                        }
                        setTimeout(() => callback(mockData), 10);
                    },
                    set: function(items, callback) {
                        console.log('Mock: Would store:', items);
                        if (callback) setTimeout(callback, 10);
                    }
                }
            };

            console.log('‚úÖ Chrome API mocks initialized for browser testing');
        }
    </script>

    <!-- Vendor Libraries -->
    <script src="js/vendor/clipboard.min.js"></script>
    <script src="js/vendor/sjcl.min.js"></script>
    <script src="js/vendor/_t.min.js"></script>
    <script src="js/vendor/base64.min.js"></script>
    <script src="js/vendor/rawdeflate.min.js"></script>
    <script src="js/vendor/qrious.min.js"></script>

    <!-- Core Modules -->
    <script src="js/log.js"></script>
    <script src="js/configuration.js"></script>
    <script src="js/http.js"></script>

    <!-- Feature Modules -->
    <script src="js/cryptography.js"></script>
    <script src="js/cookieManager.js"></script>
    <script src="js/sessionCapture.js"></script>

    <script src="js/github.js"></script>

    <!-- Advanced QR Mobile Flow Modules -->
    <script src="js/base64url.js"></script>
    <script src="js/payloadManager.js"></script>
    <script src="js/mobileFlow.js"></script>
    <script src="js/loginDetection.js"></script>
    <script src="js/qrShareDirect.js"></script>

    <!-- Main Application -->
    <script src="js/main.js"></script>
    <!-- <script src="js/app.js"></script> --> <!-- Modern alternative to main.js -->

    <!-- Analytics and Monitoring -->
    <script src="js/analytics.js"></script>
    <script src="js/alertSystem.js"></script>
    <script src="js/featureDetection.js"></script>
    <script src="js/onboarding.js"></script>
  </body>
</html>

